<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCDD Standartları İnteraktif Rehberi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Neutral & Railway Blue -->
    <!-- Application Structure Plan: Uygulama, URL hash'leri aracılığıyla yönetilen üç ana görünüme sahiptir: #home (ana filtreleme ve kart listesi), #projects (projelere ve genel standartlara göre gruplandırılmış listeler) ve #detail/<standard-id> (her standardın detay sayfası). Bu yapı, kullanıcının farklı bilgi seviyeleri arasında sorunsuz geçiş yapmasını ve belirli standartlara doğrudan erişmesini sağlar. Filtreleme ve arama, ana görünümde veri keşfini kolaylaştırırken, projeler sayfası belirli bağlamlardaki standartları öne çıkarır. Detay sayfası, her standardın kapsamlı bilgilerini sunar. -->
    <!-- Visualization & Content Choices: Ana görünümde standart kartları ve disiplinlere göre dağılımı gösteren Chart.js çubuk grafiği bulunur. Projeler sayfasında, her proje ve genel standartlar için ayrı başlıklar altında standartların basit listeleri yer alır. Her standart kartı ve liste öğesi, ilgili standardın detay sayfasına (URL hash ile) yönlendiren tıklanabilir bir bağlantıdır. Detay sayfasında, standardın tüm özellikleri (başlık, kapsam, detaylı açıklama, kritiklik, disiplinler, uygulama alanları, ilgili diğer standartlar, notlar) temiz ve okunabilir bir düzende sunulur. Geri dönme butonu ile önceki görünüme kolayca geçiş sağlanır. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .chart-container { position: relative; width: 100%; max-width: 800px; margin-left: auto; margin-right: auto; height: 300px; max-height: 350px; }
        @media (min-width: 768px) { .chart-container { height: 350px; } }
        .card-enter {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .view-section { display: none; } /* Varsayılan olarak tüm görünümleri gizle */
        .view-section.active { display: block; } /* Aktif olanı göster */
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">TCDD Standartları İnteraktif Rehberi</h1>
            <p class="mt-2 text-lg text-gray-600">Demiryolu projeleriniz için gerekli ulusal ve uluslararası standartları keşfedin.</p>
        </header>

        <!-- Ana Navigasyon Menüsü -->
        <nav class="bg-white p-4 rounded-xl shadow-md mb-8 flex justify-center space-x-4">
            <a href="#home" class="px-4 py-2 rounded-md font-medium text-blue-700 bg-blue-100 hover:bg-blue-200 transition-colors duration-200">Ana Sayfa</a>
            <a href="#projects" class="px-4 py-2 rounded-md font-medium text-blue-700 bg-blue-100 hover:bg-blue-200 transition-colors duration-200">Projeler & Genel Standartlar</a>
        </nav>

        <!-- Ana Sayfa Görünümü -->
        <div id="home-view" class="view-section">
            <div class="bg-white p-6 rounded-xl shadow-md mb-8">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label for="project-filter" class="block text-sm font-medium text-gray-700 mb-1">Projeye Göre Filtrele</label>
                        <select id="project-filter" class="w-full bg-gray-100 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <option value="all">Tüm Projeler</option>
                        </select>
                    </div>
                    <div>
                        <label for="discipline-filter" class="block text-sm font-medium text-gray-700 mb-1">Disipline Göre Filtrele</label>
                        <select id="discipline-filter" class="w-full bg-gray-100 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <option value="all">Tüm Disiplinler</option>
                        </select>
                    </div>
                    <div>
                        <label for="criticality-filter" class="block text-sm font-medium text-gray-700 mb-1">Kritikliğe Göre Filtrele</label>
                        <select id="criticality-filter" class="w-full bg-gray-100 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <option value="all">Tüm Seviyeler</option>
                        </select>
                    </div>
                    <div>
                        <label for="search-input" class="block text-sm font-medium text-gray-700 mb-1">Metin ile Ara</label>
                        <input type="text" id="search-input" placeholder="Standart kodu veya anahtar kelime..." class="w-full bg-gray-100 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-md mb-8">
                <h2 class="text-xl font-bold text-gray-800 text-center mb-4">Filtrelenmiş Standartların Disiplinlere Göre Dağılımı</h2>
                 <div class="chart-container">
                    <canvas id="standardsChart"></canvas>
                </div>
            </div>

            <div id="results-count" class="mb-4 text-gray-600 font-medium"></div>

            <div id="standards-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
            </div>
        </div>

        <!-- Projeler ve Genel Standartlar Görünümü -->
        <div id="projects-view" class="view-section p-6 bg-white rounded-xl shadow-md">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Projeler ve Genel Standartlar</h2>
            <p class="text-gray-600 mb-8 text-center">Aşağıda demiryolu projelerine ve genel kategorilere göre gruplandırılmış standartları bulabilirsiniz. Detaylar için standart adına tıklayın.</p>

            <div id="project-standards-list" class="space-y-8">
                <!-- Proje bazlı listeler buraya JS ile doldurulacak -->
            </div>
        </div>

        <!-- Standart Detay Görünümü -->
        <div id="detail-view" class="view-section p-6 bg-white rounded-xl shadow-md">
            <button id="back-button" class="mb-6 px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors duration-200">
                &larr; Geri Dön
            </button>
            <h2 id="detail-standart-baslik" class="text-3xl font-bold text-gray-900 mb-2"></h2>
            <p id="detail-standart-kod" class="text-xl font-semibold text-gray-700 mb-6"></p>
            
            <div class="mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-2">Kapsam:</h3>
                <p id="detail-standart-kapsam" class="text-base text-gray-600 leading-relaxed"></p>
            </div>

            <div class="mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-2">Detaylı Açıklama:</h3>
                <p id="detail-standart-detay" class="text-base text-gray-700 leading-relaxed"></p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                    <h3 class="text-lg font-bold text-gray-800 mb-2">Kritiklik:</h3>
                    <span id="detail-standart-kritiklik" class="bg-red-100 text-red-800 text-base font-semibold px-4 py-1 rounded-md"></span>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-800 mb-2">İlgili Disiplinler:</h3>
                    <div id="detail-standart-disiplinler" class="flex flex-wrap gap-2"></div>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-2">Uygulama Alanları:</h3>
                <div id="detail-standart-uygulama" class="flex flex-wrap gap-2"></div>
            </div>

            <div class="mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-2">İlgili Diğer Standartlar:</h3>
                <p id="detail-standart-ilgili" class="text-base text-gray-600 leading-relaxed"></p>
            </div>

            <div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">Notlar:</h3>
                <p id="detail-standart-notlar" class="text-base text-gray-600 leading-relaxed"></p>
            </div>
        </div>

    </div>

    <script>
        let standardsData = [];
        let chartInstance;
        const projectFilter = document.getElementById('project-filter');
        const disciplineFilter = document.getElementById('discipline-filter');
        const criticalityFilter = document.getElementById('criticality-filter');
        const searchInput = document.getElementById('search-input');
        const standardsGrid = document.getElementById('standards-grid');
        const resultsCount = document.getElementById('results-count');
        const homeView = document.getElementById('home-view');
        const projectsView = document.getElementById('projects-view');
        const detailView = document.getElementById('detail-view');
        const projectStandardsList = document.getElementById('project-standards-list');
        const backButton = document.getElementById('back-button');

        async function fetchStandardsData() {
            try {
                const response = await fetch('standards.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                standardsData = await response.json();
                console.log("Standards data loaded:", standardsData.length);
                populateFilters();
                initializeChart();
                router(); // Veri yüklendikten sonra router'ı çalıştır
            } catch (error) {
                console.error("Error fetching standards data:", error);
                // Kullanıcıya hata mesajı gösterebiliriz
                document.querySelector('.container').innerHTML = `<p class="text-red-600 text-center text-xl mt-10">Standart verileri yüklenirken bir hata oluştu. Lütfen daha sonra tekrar deneyin.</p>`;
            }
        }

        function getUniqueValues(data, key, separator = ', ') {
            const allValues = data.flatMap(item => item[key].split(separator).map(v => v.trim()));
            return [...new Set(allValues)].sort();
        }

        function populateFilters() {
            getUniqueValues(standardsData, 'uygulama_alani').forEach(value => {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = value;
                projectFilter.appendChild(option);
            });

            getUniqueValues(standardsData, 'disiplinler').forEach(value => {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = value;
                disciplineFilter.appendChild(option);
            });
            
            getUniqueValues(standardsData, 'kritiklik').forEach(value => {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = value;
                criticalityFilter.appendChild(option);
            });
        }

        function renderStandardsGrid(filteredData) {
            standardsGrid.innerHTML = '';
            
            resultsCount.textContent = `${filteredData.length} standart bulundu.`;

            if (filteredData.length === 0) {
                standardsGrid.innerHTML = `<p class="text-gray-500 col-span-full text-center">Seçilen kriterlere uygun standart bulunamadı.</p>`;
                return;
            }

            filteredData.forEach(std => {
                const card = document.createElement('div');
                card.className = 'bg-white border border-gray-200 rounded-lg shadow-sm p-5 flex flex-col justify-between cursor-pointer hover:shadow-lg transition-shadow duration-200 card-enter';
                card.onclick = () => {
                    history.pushState(null, '', `#detail/${std.id}`);
                    router();
                };
                
                const disiplinlerHtml = std.disiplinler.split(', ').map(d => `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 mb-2 px-2.5 py-0.5 rounded-full">${d}</span>`).join('');
                const projelerHtml = std.uygulama_alani.split(', ').map(p => `<span class="bg-green-100 text-green-800 text-xs font-medium mr-2 mb-2 px-2.5 py-0.5 rounded-full">${p}</span>`).join('');

                card.innerHTML = `
                    <div>
                        <div class="flex justify-between items-start mb-2">
                             <h3 class="text-lg font-bold text-gray-900">${std.standart}</h3>
                             <span class="bg-red-100 text-red-800 text-sm font-semibold px-3 py-1 rounded-md">${std.kritiklik}</span>
                        </div>
                        <p class="text-md font-semibold text-gray-700 mb-3">${std.baslik}</p>
                        <p class="text-sm text-gray-600 mb-4">${std.kapsam.substring(0, 150)}${std.kapsam.length > 150 ? '...' : ''}</p>
                    </div>
                    <div>
                        <div class="mb-4">
                            <h4 class="text-sm font-bold text-gray-800 mb-2">İlgili Disiplinler:</h4>
                            <div class="flex flex-wrap">${disiplinlerHtml}</div>
                        </div>
                        <div>
                            <h4 class="text-sm font-bold text-gray-800 mb-2">Uygulama Alanları:</h4>
                            <div class="flex flex-wrap">${projelerHtml}</div>
                        </div>
                    </div>
                `;
                standardsGrid.appendChild(card);
            });
        }
        
        function updateChart(filteredData) {
            if (!chartInstance) return; // Chart henüz başlatılmamışsa çık

            const disciplineCounts = {};
            const allDisciplines = getUniqueValues(standardsData, 'disiplinler');
            allDisciplines.forEach(d => disciplineCounts[d] = 0);

            filteredData.forEach(std => {
                std.disiplinler.split(', ').forEach(d => {
                    const trimmedDiscipline = d.trim();
                    if (disciplineCounts.hasOwnProperty(trimmedDiscipline)) {
                        disciplineCounts[trimmedDiscipline]++;
                    }
                });
            });

            const chartLabels = Object.keys(disciplineCounts);
            const chartData = Object.values(disciplineCounts);

            chartInstance.data.labels = chartLabels;
            chartInstance.data.datasets[0].data = chartData;
            chartInstance.update();
        }

        function filterAndRender() {
            const project = projectFilter.value;
            const discipline = disciplineFilter.value;
            const criticality = criticalityFilter.value;
            const searchTerm = searchInput.value.toLowerCase();

            const filtered = standardsData.filter(std => {
                const projectMatch = project === 'all' || std.uygulama_alani.includes(project);
                const disciplineMatch = discipline === 'all' || std.disiplinler.includes(discipline);
                const criticalityMatch = criticality === 'all' || std.kritiklik.includes(criticality);
                
                const searchMatch = !searchTerm || 
                    std.standart.toLowerCase().includes(searchTerm) ||
                    std.baslik.toLowerCase().includes(searchTerm) ||
                    std.kapsam.toLowerCase().includes(searchTerm) ||
                    (std.detayli_aciklama && std.detayli_aciklama.toLowerCase().includes(searchTerm)) ||
                    (std.ilgili_diger && std.ilgili_diger.toLowerCase().includes(searchTerm)) ||
                    (std.notlar && std.notlar.toLowerCase().includes(searchTerm));

                return projectMatch && disciplineMatch && criticalityMatch && searchMatch;
            });

            renderStandardsGrid(filtered);
            updateChart(filtered);
        }
        
        function initializeChart() {
            const ctx = document.getElementById('standardsChart').getContext('2d');
            if (chartInstance) {
                chartInstance.destroy(); // Önceki chart instance'ı yok et
            }
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Standart Sayısı',
                        data: [],
                        backgroundColor: 'rgba(59, 130, 246, 0.5)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                           callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    return `${label}: ${context.raw}`;
                                }
                           }
                        }
                    }
                }
            });
        }

        function renderProjectsPage() {
            projectStandardsList.innerHTML = '';
            const projects = getUniqueValues(standardsData, 'uygulama_alani');
            const generalStandards = standardsData.filter(std => std.uygulama_alani.includes('Tüm Projeler'));

            // Genel Standartlar
            const generalSection = document.createElement('div');
            generalSection.className = 'bg-gray-50 p-4 rounded-lg shadow-sm';
            generalSection.innerHTML = `
                <h3 class="text-xl font-bold text-gray-800 mb-4">Genel Standartlar</h3>
                <ul class="list-disc pl-5 space-y-2">
                    ${generalStandards.map(std => `
                        <li><a href="#detail/${std.id}" class="text-blue-600 hover:underline font-medium">${std.standart} - ${std.baslik}</a></li>
                    `).join('')}
                </ul>
            `;
            projectStandardsList.appendChild(generalSection);

            // Proje Bazlı Standartlar
            projects.filter(p => p !== 'Tüm Projeler').forEach(project => {
                const projectSpecificStandards = standardsData.filter(std => std.uygulama_alani.includes(project) && !std.uygulama_alani.includes('Tüm Projeler'));
                if (projectSpecificStandards.length > 0) {
                    const projectSection = document.createElement('div');
                    projectSection.className = 'bg-gray-50 p-4 rounded-lg shadow-sm';
                    projectSection.innerHTML = `
                        <h3 class="text-xl font-bold text-gray-800 mb-4">${project} Projesi Standartları</h3>
                        <ul class="list-disc pl-5 space-y-2">
                            ${projectSpecificStandards.map(std => `
                                <li><a href="#detail/${std.id}" class="text-blue-600 hover:underline font-medium">${std.standart} - ${std.baslik}</a></li>
                            `).join('')}
                        </ul>
                    `;
                    projectStandardsList.appendChild(projectSection);
                }
            });
        }

        function showStandardDetail(standardId) {
            const std = standardsData.find(s => s.id === standardId);
            if (!std) {
                history.replaceState(null, '', '#home'); // Standart bulunamazsa ana sayfaya dön
                router();
                return;
            }

            document.getElementById('detail-standart-baslik').textContent = std.baslik;
            document.getElementById('detail-standart-kod').textContent = std.standart;
            document.getElementById('detail-standart-kapsam').textContent = std.kapsam;
            document.getElementById('detail-standart-detay').textContent = std.detayli_aciklama || 'Detaylı açıklama bulunmamaktadır.';
            document.getElementById('detail-standart-kritiklik').textContent = std.kritiklik;

            const detailDisiplinler = document.getElementById('detail-standart-disiplinler');
            detailDisiplinler.innerHTML = std.disiplinler.split(', ').map(d => `<span class="bg-blue-100 text-blue-800 text-sm font-medium px-2.5 py-0.5 rounded-full">${d}</span>`).join('');

            const detailUygulama = document.getElementById('detail-standart-uygulama');
            detailUygulama.innerHTML = std.uygulama_alani.split(', ').map(p => `<span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full">${p}</span>`).join('');

            document.getElementById('detail-standart-ilgili').textContent = std.ilgili_diger || 'Yok';
            document.getElementById('detail-standart-notlar').textContent = std.notlar || 'Yok';
        }

        function router() {
            const hash = window.location.hash;
            homeView.classList.remove('active');
            projectsView.classList.remove('active');
            detailView.classList.remove('active');

            if (hash.startsWith('#detail/')) {
                detailView.classList.add('active');
                const standardId = hash.substring('#detail/'.length);
                showStandardDetail(standardId);
            } else if (hash === '#projects') {
                projectsView.classList.add('active');
                renderProjectsPage();
            } else {
                homeView.classList.add('active');
                filterAndRender(); // Ana sayfada filtreleri ve kartları yeniden render et
            }
        }

        backButton.addEventListener('click', () => {
            history.back(); // Tarayıcı geçmişinde bir adım geri git
        });

        window.addEventListener('hashchange', router);

        projectFilter.addEventListener('change', filterAndRender);
        disciplineFilter.addEventListener('change', filterAndRender);
        criticalityFilter.addEventListener('change', filterAndRender);
        searchInput.addEventListener('input', filterAndRender);

        document.addEventListener('DOMContentLoaded', () => {
            fetchStandardsData();
        });
    </script>
</body>
</html>
